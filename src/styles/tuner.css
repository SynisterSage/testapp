/* Keep page inside shell + consistent gutters */
.tuner-page { width: calc(100% - 0px); margin-inline: auto; box-sizing: border-box; }
.tuner-page--fixed { display: grid; grid-auto-rows: min-content; gap: 12px; }
.tuner-page--fixed > * { min-width: 0; }
.tuner-ring-wrap, .tuner-hero, .tuner-head.panel, .drum-picker .drum-scroll { max-width: 100%; }

/* Head row: smaller Prev/Next */
.tuner-head-row .ghost-btn.ghost-btn--sm { padding: 6px 10px; font-size: 12px; border-radius: 10px; }

/* Spacing tweaks so elements aren't cramped */
.tuner-ring-wrap { display: flex; justify-content: center; align-items: center; padding: 4px 8px 2px; }
.tuner-hero { display: grid; gap: 8px; align-items: center; justify-items: center; padding: 0 10px; }
.tuner-hero--flat { background: transparent; border: 0; }
.tuner-note { font-size: 42px; line-height: 1; font-weight: 800; letter-spacing: .5px; }
.tuner-hz { font-size: 14px; color: var(--text-dim); }

/* Use a shared "measure" so chart width == cents bar width */
.tuner-measure { padding: 0 10px; }

/* Cents meter (tight but readable) */
.cents-wrap { display: grid; gap: 6px; width: 100%; }
.cents-scale { display: grid; grid-template-columns: repeat(5, 1fr); font-size: 10px; color: var(--text-dim); }
.cents-bar {
  position: relative; height: 16px; border-radius: 999px;
  background: linear-gradient(90deg,
    rgba(248,113,113,.25) 0%,
    rgba(248,113,113,.25) 40%,
    rgba(74,222,128,.35) 47%,
    rgba(74,222,128,.35) 53%,
    rgba(248,113,113,.25) 60%,
    rgba(248,113,113,.25) 100%);
  border: 1px solid var(--border); overflow: hidden;
}
.cents-green { position: absolute; left: 47%; width: 6%; top: 0; bottom: 0; background: rgba(74,222,128,.5); }
.cents-needle { position: absolute; top: -4px; bottom: -4px; width: 2px; background: #fff; border-radius: 2px; box-shadow: 0 0 8px rgba(255,255,255,.5); }
:root[data-theme="light"] .cents-needle { background: #0b0f14; box-shadow: 0 0 8px rgba(0,0,0,.35); }
.cents-readout { text-align: center; font-weight: 600; }

/* Strip chart (same width as cents bar) */
.strip-wrap { width: 100%; }
.strip-chart { display: block; width: 100%; height: 54px; }
.strip-bg { fill: rgba(124,58,237,.10); }
.strip-lock { fill: rgba(34,197,94,.22); }
.strip-mid { stroke: rgba(255,255,255,.25); stroke-width: 1; }
.strip-trace { fill: none; stroke: #a78bfa; stroke-width: 2; }
.strip-scale { fill: var(--text-dim); font-size: 10px; }

/* Stats below chart in one line */
.tuner-stats-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-top: 6px;
  font-size: 12px;
  color: var(--text-dim);
}
.metric-label { opacity: .95; margin-right: 4px; }

/* Lug ring visuals */
.lug-ring { filter: drop-shadow(0 2px 10px rgba(0,0,0,.2)); }
.lug-ring-outline { fill: none; stroke: rgba(124,58,237,.25); stroke-width: 2; }
.lug-node { fill: rgba(124,58,237,.35); stroke: rgba(255,255,255,.25); stroke-width: 1; }
.lug-node--active { fill: rgba(139,92,246,.9); }
.lug-node-glow { fill: rgba(139,92,246,.25); }
.lug-node--locked { stroke: rgba(34,197,94,.9); stroke-width: 2; }
.lug-node--high { filter: drop-shadow(0 0 6px rgba(248,113,113,.6)); }
.lug-node--low { filter: drop-shadow(0 0 6px rgba(59,130,246,.5)); }
.lug-label { font-size: 10px; text-anchor: middle; fill: var(--text-dim); }
.lug-cents { font-size: 10px; text-anchor: middle; fill: #fff; opacity: .85; }
.lug-check { fill: #fff; font-size: 12px; font-weight: 800; }
/* =========================================================
   LUG RING â€” refined idle + active + completion animations
   (presentation only; respects reduced motion)
   ========================================================= */

:root[data-theme="light"] .lug-node-halo { background: transparent; }

@media (prefers-reduced-motion: no-preference) {
  /* --- OUTER RING (idle) --- */
  .outer-ring-group { pointer-events: none; } /* visuals only */

  .outer-ring {
    fill: none;
    stroke: url(#lr-outer-grad);
    stroke-width: 3;
    opacity: .75;
    filter: drop-shadow(0 0 10px rgba(124,58,237,.25));
  }

  /* slow rotation of gradient (rotate the group around center) */
  .outer-rotate {
    transform-origin: center;
    animation: lr-outer-rotate 20s linear infinite;
  }
  @keyframes lr-outer-rotate { to { transform: rotate(360deg); } }

  /* outward sonar pulses every ~4s, very subtle */
  .outer-pulse { transform-origin: center; }
  .outer-ripple {
    fill: none;
    stroke: rgba(167,139,250,.22);
    stroke-width: 2;
    transform-origin: center;
    animation: lr-outer-ripple 4s ease-out infinite;
  }
  .outer-ripple--late1 { animation-delay: .6s; }
  .outer-ripple--late2 { animation-delay: 1.2s; }

  @keyframes lr-outer-ripple {
    0%   { transform: scale(1);     opacity: .35; }
    70%  { transform: scale(1.25);  opacity: .06; }
    100% { transform: scale(1.3);   opacity: 0; }
  }

  /* --- ACTIVE LUG breathing --- */
  .lug-node-halo {
    fill: rgba(139,92,246,.22);
    animation: lr-halo-breathe 1.5s ease-in-out infinite;
  }
  @keyframes lr-halo-breathe {
    0%,100% { transform: scale(1);   opacity: .65; }
    50%     { transform: scale(1.08); opacity: .35; }
  }

  /* --- COMPLETION (on lock): pop + ring draw + glint --- */
  .lug-node--locked { animation: lr-pop 3s ease-out; }
  @keyframes lr-pop {
    0% { transform: scale(1); }
    50% { transform: scale(.92); }
    100% { transform: scale(1); }
  }

  .lug-lock-ring {
    fill: none;
    stroke: rgba(34,197,94,.95);
    stroke-width: 2;
    stroke-dasharray: 80 80;
    stroke-dashoffset: 80;       /* start hidden */
    animation: lr-ring-draw 0.95s ease-out forwards;
    filter: drop-shadow(0 0 6px rgba(34,197,94,.35));
  }
  @keyframes lr-ring-draw { to { stroke-dashoffset: 0; } }

  .lug-glint { pointer-events: none; }
  .lug-glint-arc {
    fill: none;
    stroke: rgba(255,255,255,.45);
    stroke-width: 1.25;
    stroke-linecap: round;
    stroke-dasharray: 50 80;
    stroke-dashoffset: 50;
    filter: drop-shadow(0 0 6px rgba(255,255,255,.25));
    animation: lr-glint 420ms ease-out forwards;
  }
  .lug-glint-arc--delayed { animation-delay: 90ms; opacity: .75; }

  @keyframes lr-glint {
    0%   { stroke-dashoffset: 50; opacity: .65; }
    80%  { stroke-dashoffset: 0;  opacity: .25; }
    100% { opacity: 0; }
  }
}

/* keep your existing look & hints */
.lug-ring-outline { fill: none; stroke: rgba(124,58,237,.25); stroke-width: 2; }

/* tone mapping you already had (retain) */
.lug-node--high { filter: drop-shadow(0 -2px 8px rgba(248,113,113,.55)); }
.lug-node--low  { filter: drop-shadow(0  2px 8px rgba(59,130,246,.5)); }

/* cents settle (no idle shimmer) */
.lug-cents { opacity: .75; transition: opacity .18s ease, transform .18s ease; }
/* prevent pulse clipping */
.lug-ring { overflow: visible; }

/* ===== OUTER RING ===== */
@media (prefers-reduced-motion: no-preference) {
  .outer-ring-group { pointer-events: none; }

  .outer-ring {
    fill: none;
    stroke: url(#lr-outer-grad);
    stroke-width: 3;
    opacity: .78;
    filter: drop-shadow(0 0 10px rgba(124,58,237,.25));
  }

  /* slow rotation on the purple gradient */
  .outer-rotate { transform-origin: center; animation: lr-outer-rotate 22s linear infinite; }
  @keyframes lr-outer-rotate { to { transform: rotate(360deg); } }

  /* faint outward pulses (no square edges) */
  .outer-pulse { transform-origin: center; }
  .outer-ripple {
    fill: none;
    stroke: rgba(167,139,250,.18);
    stroke-width: 2;
    transform-origin: center;
    animation: lr-outer-ripple 4.2s ease-out infinite;
  }
  .outer-ripple--late1 { animation-delay: .6s; }
  .outer-ripple--late2 { animation-delay: 1.2s; }
  @keyframes lr-outer-ripple {
    0%   { transform: scale(1);    opacity: .26; }
    70%  { transform: scale(1.25); opacity: .06; }
    100% { transform: scale(1.3);  opacity: 0; }
  }

  /* green sweep that animates ON when active lug locks, OFF when it advances */
  .outer-ring-green {
    fill: none;
    stroke: url(#lr-green-grad);
    stroke-width: 3.5;
    filter: drop-shadow(0 0 8px rgba(34,197,94,.25));
    /* sweep control via dashoffset (pathLength=100 on the element) */
    stroke-dasharray: 100;
    transition: stroke-dashoffset .55s ease, opacity .2s ease;
  }
  .outer-ring-green.is-on  { stroke-dashoffset: 0;   opacity: 1; }
  .outer-ring-green.is-off { stroke-dashoffset: 100; opacity: 0; }
}

/* static outline (kept) */
.lug-ring-outline { fill: none; stroke: rgba(124,58,237,.25); stroke-width: 10; }

/* ===== ACTIVE LUG: in-place pulse ===== */
@media (prefers-reduced-motion: no-preference) {
  .lug-active-pulse {
    fill: rgba(139,92,246,.22);
    transform-origin: center;
    animation: lr-inplace-pulse 1.35s ease-in-out infinite;
  }
  @keyframes lr-inplace-pulse {
    0%,100% { transform: scale(1);   opacity: .55; }
    50%     { transform: scale(1.12); opacity: .28; }
  }
}

/* ===== COMPLETED (slower draw) ===== */
@media (prefers-reduced-motion: no-preference) {
  .lug-node--locked { animation: lr-pop 160ms ease-out; }
  @keyframes lr-pop { 0%{transform:scale(1);} 60%{transform:scale(.92);} 100%{transform:scale(1);} }

  .lug-lock-ring {
    fill: none;
    stroke: rgba(34,197,94,.95);
    stroke-width: 2;
    stroke-dasharray: 80 80;
    stroke-dashoffset: 80;
    animation: lr-ring-draw 420ms ease-out forwards; /* slowed a tad */
    filter: drop-shadow(0 0 6px rgba(34,197,94,.35));
  }
  @keyframes lr-ring-draw { to { stroke-dashoffset: 0; } }

  .lug-glint { pointer-events: none; }
  .lug-glint-arc {
    fill: none;
    stroke: rgba(255,255,255,.45);
    stroke-width: 1.25;
    stroke-linecap: round;
    stroke-dasharray: 50 80;
    stroke-dashoffset: 50;
    filter: drop-shadow(0 0 6px rgba(255,255,255,.22));
    animation: lr-glint 540ms ease-out forwards;
  }
  .lug-glint-arc--delayed { animation-delay: 110ms; opacity: .78; }
  @keyframes lr-glint {
    0%   { stroke-dashoffset: 50; opacity: .65; }
    80%  { stroke-dashoffset: 0;  opacity: .28; }
    100% { opacity: 0; }
  }
}

/* keep your hint styling */
.lug-node--high { filter: drop-shadow(0 -2px 8px rgba(248,113,113,.55)); }
.lug-node--low  { filter: drop-shadow(0  2px 8px rgba(59,130,246,.5)); }
.lug-cents { opacity: .75; transition: opacity .18s ease, transform .18s ease; }
.lug-center { pointer-events: none; }
.lug-center-bg {
  fill: rgba(9,12,16,.72);
  stroke: rgba(124,58,237,.35);
  stroke-width: 1;
  filter: drop-shadow(0 4px 12px rgba(0,0,0,.35));
}
.lug-center-text {
  font-size: 13px;
  font-weight: 800;
  fill: #eae9ff;
  letter-spacing: .2px;
}
@media (prefers-reduced-motion: no-preference) {
  .lug-center { animation: lr-center-pop .25s ease-out; }
  @keyframes lr-center-pop { from { opacity:0; transform:scale(.96) } to { opacity:1; transform:scale(1) } }
}
